### :link: 2025-08-19
- [예약 챗봇 API 엔드포인트](#0-예약-챗봇-api-엔드포인트)
- [LLM을 이용한 사용자 의도(Intent) 분석](#1-llm을-이용한-사용자-의도intent-분석)
 
&nbsp; 
### 0. 예약 챗봇 API 엔드포인트

`POST /api/v1/reservation/chat`

- **Dispatcher** 패턴을 적용하여 사용자 요청의 의도(Intent)에 따라 적절한 처리 함수(Handler)를 호출

```python
# llm/app/api/user_reservation_chat.py

# 의도(intent)와 핸들러 함수를 매핑
intent_handlers = {
    "greeting": handle_greeting,
    "view_reservations": handle_view_reservations,
    "cancel_reservation": handle_cancel_reservation,
    "search_shops": handle_search_shops,
    "unknown": handle_unknown,
}

@router.post("/chat")
async def reservation_assistant(request: Request, ...):
    # ...
    # 1. 사용자의 의도(intent) 결정
    intent = await determine_reservation_intent(query)

    # 2. 적절한 핸들러를 찾아 실행
    handler = intent_handlers.get(intent, handle_unknown)
    response = await handler(context)
    return response
```
 
&emsp; 
&nbsp;
### 1. LLM을 이용한 사용자 의도(Intent) 분석

챗봇이 사용자의 요청을 이해하고 적절한 기능으로 연결해주려면, 먼저 사용자의 자연어 입력에서 의도를 파악해야 했다. 이를 위해 OpenAI의 LLM을 활용하는 `determine_reservation_intent` 함수를 구현다.

LLM에 사용자의 질문을 전달하며, 미리 정의된 몇 가지 작업 종류(`view_reservations`, `cancel_reservation`, `search_shops`, `unknown`) 중 가장 적합한 것을 선택하도록 요청합니다. LLM이 `JSON 형식`으로만 응답하도록 지시하여, 반환된 값을 파싱하여 후속 로직에서 안정적으로 사용할 수 있도록 설계했습니다.

```yaml
# llm/app/core/settings/user_reservation_bot.yaml

# 'reservation_assistant' 프롬프트
user_prompt: |
  당신은 사용자의 요청을 분석하여 어떤 작업을 수행해야 하는지 결정하는 AI 어시스턴트입니다.
  다음 규칙에 따라 사용자의 의도를 파악하고 JSON 형식으로만 응답하세요.
  ## 작업 종류:
  - `view_reservations`: 사용자가 자신의 예약 내역을 보거나 확인하려 할 때.
  - `cancel_reservation`: 사용자가 예약을 취소하려고 할 때.
  - `search_shops`: 사용자가 새로운 샵이나 메뉴를 찾거나 추천받고 싶을 때.
  - `unknown`: 위 세 가지에 해당하지 않거나 의도가 불분명할 때.
  ## 출력 형식 (반드시 이 형식만):
  {{
      "intent": "view_reservations|cancel_reservation|search_shops|unknown"
  }}
  ---
  사용자 요청: {query}
```

https://github.com/BOA-with-elephant/Header-backend/pull/233