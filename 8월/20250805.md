### :link: 2025-08-05
- [LangChain](#langchain)
 
&nbsp;
### LangChain
LangChain의 핵심 구조는 "Prompt → LLM → OutputParser"로 구성된 **Chain**이다. 이 파일은 이를 실습하며 익힌 내용을 정리한 것이다.

#### 1) 환경 설정

- API Key 등 환경 변수 로딩:

```python
from dotenv import load_dotenv
load_dotenv()
```

#### 2) LangChain 구성 요소
1. **Prompt (입력 설계)**
2. **LLM (모델 실행)**
3. **OutputParser (출력 파싱)**

#### 3) Prompt 구성

**단일 입력값 템플릿 사용 예시**

```python
from langchain import PromptTemplate

template = "가장 강한 포켓몬이 뭐야? \n 형식 지정: {format}"

prompt = PromptTemplate(
    template=template,
    input_variables={'format'}
)
```

**ChatPromptTemplate 사용 예시**

```python
from langchain_core.prompts import ChatPromptTemplate

prompt_template = ChatPromptTemplate.from_messages([
    ('system', '너는 애니메이션을 좋아하는 챗봇이야. 사용자의 질문에 냐옹이 말투로 대답해줘'),
    ('user', '{question}')
])
```

#### 4) LLM 구성

**GPT 모델 객체 생성**

```python
from langchain_openai import ChatOpenAI

model = ChatOpenAI(
    model_name='gpt-4o',
    temperature=1,
    max_tokens=2048
)
```

#### 5) OutputParser 사용

LangChain에서는 결과를 문자열 등으로 파싱할 때 `StrOutputParser`를 사용한다.

```python
from langchain_core.output_parsers import StrOutputParser

output_parser = StrOutputParser()
```

> `.get_format_instructions()` 메소드는 필요한 응답 형식을 텍스트로 출력할 수 있다 (체인에 삽입 가능).

#### 6) Chain 실행

**프롬프트 + 모델 체인**

```python
chain = prompt | model

response = chain.invoke(format_instructions)
answer = output_parser.parse(response.content)
print(answer)
```

**프롬프트 + 모델 + Output Parser 구성 예시**

```python
chain = prompt_template | model | output_parser

response = chain.invoke({'question': '어떤 포켓몬이 가장 강해?'})
print(response)
```

> ChatPromptTemplate 사용 시 `invoke()` 입력값은 딕셔너리 형태로 전달해야 한다 (`{question: "..."}`).

**실습 결과**

> 냐옹, 포켓몬 세계에서는 다양한 강력한 포켓몬이 많은데, 어떤 포켓몬이 가장 강한지는 상황과 전략에 따라 달라질 수 있어, 냐옹!

**정리**

| 구성 요소                | 설명                                    |
| -------------------- | ------------------------------------- |
| `PromptTemplate`     | 입력 문장의 구조를 설계하는 템플릿                   |
| `ChatPromptTemplate` | 대화형 시스템에 적합한 프롬프트 템플릿                 |
| `ChatOpenAI`         | OpenAI 기반 모델 호출 객체                    |
| `StrOutputParser`    | LLM 응답 결과를 문자열로 파싱                    |
| `Chain`              | Prompt → Model → Parser 순으로 구성된 처리 흐름 |