### :link: 2025-08-13

- [ErrorCode Enum Http 상태 코드 추가](#1-errorcode-enum-http-상태-코드-추가)
- [예외 처리 중앙화](#2-예외-처리-중앙화)
 
&nbsp; 
### 1. ErrorCode Enum Http 상태 코드 추가
담당 도메인의 `ErrorCode` Enum에 HTTP 상태 코드 정보를 포함시키는 리팩토링을 확장 적용했다.

```java
// SHOP_NOT_FOUND("SHOP_NOT_FOUND", "해당 샵을 찾을 수 없습니다."),
// SHOP_DEACTIVATED("SHOP_DEACTIVATED", "해당 샵은 비활성화 되었습니다."),

SHOP_NOT_FOUND("SHOP_NOT_FOUND", "해당 샵을 찾을 수 없습니다.", HttpStatus.NOT_FOUND),
SHOP_DEACTIVATED("SHOP_DEACTIVATED", "해당 샵은 비활성화 되었습니다.", HttpStatus.GONE),
```
이로써 `GlobalExceptionHandlerForApiResponse`는 발생한 예외로부터 `HttpStatus`를 가져와 사용자에게 정확한 Http 상태 코드로 응답할 수 있게 했다.

&emsp; 
&nbsp;
### 2. 예외 처리 중앙화

기존에는 `ShopExceptionHandler` 등 각 도메인별로 예외를 처리하는 핸들러가 일부 존재하여 예외 처리 방식이 분산되어 있었다.

이러한 구조를 개선하기 위해, 특정 도메인들의 예외 처리를 `GlobalExceptionHandlerForApiResponse` 클래스 한 곳으로 통합하는 작업을 진행했다. **Shop, ShopHoliday, UserReservation** 도메인에서 발생하는 커스텀 예외들을 모두 이 중앙 핸들러가 감지하여 처리하도록 수정했다.

```java
// GlobalExceptionHandlerForApiResponse.java

/**
 * 전역 예외 처리기
 *
 * - 전역 모든 예외를 통합 관리
 * - NotFoundException을 주로 사용하여 리소스 찾기 실패 처리
 * - 적절한 HTTP 상태 코드와 함께 구조화된 에러 정보 반환
 */
@RestControllerAdvice(basePackages = {
        "com.header.header.domain.shop",
        "com.header.header.domain.reservation" // 패키지 추가
})
@Slf4j
public class GlobalExeptionHandlerForApiResponse {

    /*
    * ShopException 처리
    *
    * - Shop 도메인의 예외 처리 시 발생
    * - ShopErrorCode enum에 처리해둔 HttpStatus에 따라 응답
    * */
    @ExceptionHandler(ShopExceptionHandler.class)
    public ResponseEntity<ApiResponse<ErrorResponse>> handleShopExceptionHandler(
            ShopExceptionHandler ex, WebRequest request
    ){
        ShopErrorCode errorCode = ex.getShopErrorCode();

        log.error("ShopException 발생: {} - {} ", errorCode, errorCode.getMessage(), ex);

        ErrorResponse errorResponse = ErrorResponse.of(
                errorCode.getHttpStatus().value(),
                errorCode.getCode(),
                ex.getMessage(),
                request.getDescription(false).replace("uri=", "")
        );

        return ResponseEntity.status(errorCode.getHttpStatus()).body(ApiResponse.fail(errorCode.getMessage(), errorResponse));
    }

    /*
     * ShopHolidayException 처리
     *
     * - Shop 도메인 - Shop Holiday의 예외 처리 시 발생
     * - ShopHolidayErrorCode enum에 처리해둔 HttpStatus에 따라 응답
     * */
    @ExceptionHandler(ShopHolidayExceptionHandler.class)
    public ResponseEntity<ApiResponse<ErrorResponse>> handleShopHolidayExceptionHandler(
            ShopHolidayExceptionHandler ex, WebRequest request
    ){
        ShopHolidayErrorCode errorCode = ex.getShopHolidayErrorCode();

        log.error("ShopHolidayException 발생: {} - {} ", errorCode, errorCode.getMessage(), ex);

        ErrorResponse errorResponse = ErrorResponse.of(
                errorCode.getHttpStatus().value(),
                errorCode.getCode(),
                errorCode.getMessage(),
                request.getDescription(false).replace("uri=", "")
        );
        return ResponseEntity.status(errorCode.getHttpStatus()).body(ApiResponse.fail(errorCode.getMessage(), errorResponse));
    }

    /*
     * UserReservationException 처리
     *
     * - UserReservation 도메인의 예외 처리 시 발생
     * - UserReservationErrorCode enum에 처리해둔 HttpStatus에 따라 응답
     * */
    @ExceptionHandler(UserReservationExceptionHandler.class)
    public ResponseEntity<ApiResponse<ErrorResponse>> handleUserReservationExceptionHandler(
            UserReservationExceptionHandler ex, WebRequest request
    ){
        UserReservationErrorCode errorCode = ex.getURErrorCode();

        log.error("UserReservationException 발생: {} - {} ", errorCode, errorCode.getMessage(), ex);

        ErrorResponse errorResponse = ErrorResponse.of(
                errorCode.getHttpStatus().value(),
                errorCode.getCode(),
                errorCode.getMessage(),
                request.getDescription(false).replace("uri=", "")
        );

        return ResponseEntity.status(errorCode.getHttpStatus()).body(ApiResponse.fail(errorCode.getMessage(), errorResponse));
    }

    /*코드 생략*/
```

결론: 여러 도메인에 걸쳐 발생하던 비즈니스 예외들이 `ApiResponse` 형식으로 통일되며 에러 처리 편의성을 높였다.

https://github.com/BOA-with-elephant/Header-backend/pull/191