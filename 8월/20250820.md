### :link: 2025-08-20
- [자연어 기반 검색 조건 추출](#자연어-기반-검색-조건-추출)
 
&nbsp; 
### 자연어 기반 검색 조건 추출
- `GET /api/v1/shops/shop-menu-categories` → 기존 샵 카테고리, 메뉴 키워드 학습

```java
// ShopCategoryService.java
public ShopAndMenuCategoryDTO findAllShopAndMenuCategories() {
    ShopAndMenuCategoryDTO dto = new ShopAndMenuCategoryDTO();
    // DB에서 모든 샵 카테고리 조회
    List<ShopCategoryDTO> shopCategories = ...;
    // DB에서 모든 메뉴의 대표 키워드 조회
    List<MenuCategoryForLLM> menuCategories = menuCategoryRepository.findMenuCategoryForLLM();
    
    dto.setShopCategories(shopCategories);
    dto.setMenuCategories(menuCategories);
    return dto;
}
```

- 학습된 데이터 + 사용자 요청 → 가장 적합한 `categoryCode` 또는 `keyword` JSON 반환

```yaml
# llm/app/core/settings/user_reservation_bot.yaml

    user_prompt: |
      당신은 전문 API 라우팅 어시스턴트입니다.
      당신의 임무는 사용자 요청을 분석하여 유효한 JSON 객체 하나만 반환하는 것입니다.
      다른 텍스트나 설명, 마크다운 코드 블록 없이 오직 JSON 객체만 응답해야 합니다.

      ## JSON 구조:
      {{
        "reasoning": "단계별 사고 과정",
        "categoryCode": <정수 또는 null>,
        "keyword": "<문자열 또는 null>"
      }}

      ## 규칙:
      1.  `reasoning` 필드에 사용자의 요청을 어떻게 분석했는지 단계별로 서술하세요.
      2.  요청이 '샵 카테고리'와 관련있으면, '사용 가능한 샵 카테고리' 목록에서 가장 일치하는 항목의 `categoryCode`를 `categoryCode` 필드에 설정하세요. `keyword`는 `null`이어야 합니다.
      3.  요청이 '메뉴'와 관련있으면, '사용 가능한 메뉴 키워드' 목록에서 가장 일치하는 키워드를 `keyword` 필드에 설정하세요. `categoryCode`는 `null`이어야 합니다.
      4.  `categoryCode`와 `keyword` 둘 다에 값이 있어서는 안 됩니다.
      5.  정확히 일치하는 카테고리나 키워드가 없으면 `categoryCode`와 `keyword` 모두 `null`로 설정하세요.
      6.  모든 필드는 반드시 포함되어야 합니다
      7.  reasoning 필드는 빈 문자열이 될 수 없습니다.

      ## 사용 가능한 샵 카테고리:
      {shop_categories_json}

      ## 사용 가능한 메뉴 키워드:
      {menu_keywords_list}

      ## 예시:
      요청: "머리 자르고 싶은데 샵 추천해줘"
      응답:
      {{"reasoning":"사용자가 '자르고 싶다'고 명시했으므로 메뉴와 관련이 있습니다. '사용 가능한 메뉴 키워드' 목록에서 '컷'이 가장 적합합니다. 따라서 keyword를 '컷'으로 설정하고 categoryCode는 null로 합니다.","categoryCode":null,"keyword":"컷"}}

      ---
      이제, 다음 사용자 요청을 분석하여 규칙에 따라 JSON 객체 하나만 반환하세요.
      ---
      사용자 요청: {query}
```

- "근처 네일샵 있어?" → `categoryCode: 2`
- "파마하고 싶어" → `keyword: 파마`

https://github.com/BOA-with-elephant/Header-backend/pull/233